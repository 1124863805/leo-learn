(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{660:function(t,a,s){"use strict";s.r(a);var n=s(17),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nio基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nio基础"}},[t._v("#")]),t._v(" NIO基础")]),t._v(" "),s("h3",{attrs:{id:"_1-channel-buffer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-channel-buffer"}},[t._v("#")]),t._v(" 1 Channel & Buffer")]),t._v(" "),s("h4",{attrs:{id:"bytebuffer-正确使用姿势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bytebuffer-正确使用姿势"}},[t._v("#")]),t._v(" ByteBuffer 正确使用姿势")]),t._v(" "),s("ol",[s("li",[t._v("向buffer 写入数据")]),t._v(" "),s("li",[t._v("调用flip（）切换至读模式")]),t._v(" "),s("li",[t._v("从buffer读取数据 buffe.get()")]),t._v(" "),s("li",[t._v("调用clear或者 compact() 切换写模式 (compact 在没有读完的情况下,保留之前的，继续往下写入)")]),t._v(" "),s("li",[t._v("重复1～4步骤")])]),t._v(" "),s("p",[t._v("ByteBuffer结构")]),t._v(" "),s("p",[t._v("​\tposition")]),t._v(" "),s("p",[t._v("​\t\t写模式下 postion是写入位置，limt等于容量 capacity容量")]),t._v(" "),s("p",[t._v("​\t\t flip动作发生后，postion切换为读取位置，limit 读取限制 Capactiy容量")]),t._v(" "),s("p",[t._v("​")]),t._v(" "),s("p",[t._v("​")]),t._v(" "),s("h3",{attrs:{id:"_2-selector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-selector"}},[t._v("#")]),t._v(" 2 Selector")]),t._v(" "),s("h4",{attrs:{id:"多线程版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多线程版本"}},[t._v("#")]),t._v(" 多线程版本")]),t._v(" "),s("p",[t._v("​\t\t内存占用高。线程上下文切换成本高，只适合连接数少的场景")]),t._v(" "),s("h4",{attrs:{id:"线程池版缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程池版缺点"}},[t._v("#")]),t._v(" 线程池版缺点")]),t._v(" "),s("p",[t._v("​\t\t 阻塞模式下，线程仅能处理一个scoket连接")]),t._v(" "),s("p",[t._v("​\t\t 仅适合短连接场景")]),t._v(" "),s("h4",{attrs:{id:"selector版本设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#selector版本设计"}},[t._v("#")]),t._v(" Selector版本设计")]),t._v(" "),s("p",[t._v("​\tThread 管理 select ，select 监听 channel事件")]),t._v(" "),s("h3",{attrs:{id:"_2-3-bytebuffer-常见方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-bytebuffer-常见方法"}},[t._v("#")]),t._v(" 2.3 ByteBuffer 常见方法")]),t._v(" "),s("h4",{attrs:{id:"分配空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分配空间"}},[t._v("#")]),t._v(" 分配空间")]),t._v(" "),s("p",[t._v("可以使用 allocate 方法为 ByteBuffer 分配空间，其它 buffer 类也有该方法")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bytebuffer")]),t._v(" buf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("allocate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"向-buffer-写入数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#向-buffer-写入数据"}},[t._v("#")]),t._v(" 向 buffer 写入数据")]),t._v(" "),s("p",[t._v("有两种办法")]),t._v(" "),s("ul",[s("li",[t._v("调用 channel 的 read 方法")]),t._v(" "),s("li",[t._v("调用 buffer 自己的 put 方法")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" readBytes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("和")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"从-buffer-读取数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从-buffer-读取数据"}},[t._v("#")]),t._v(" 从 buffer 读取数据")]),t._v(" "),s("p",[t._v("同样有两种办法")]),t._v(" "),s("ul",[s("li",[t._v("调用 channel 的 write 方法")]),t._v(" "),s("li",[t._v("调用 buffer 自己的 get 方法")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" writeBytes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("和")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("get 方法会让 position 读指针向后走，如果想重复读取数据")]),t._v(" "),s("ul",[s("li",[t._v("可以调用 rewind 方法将 position 重新置为 0")]),t._v(" "),s("li",[t._v("或者调用 get(int i) 方法获取索引 i 的内容，它不会移动读指针")])]),t._v(" "),s("h4",{attrs:{id:"mark-和-reset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mark-和-reset"}},[t._v("#")]),t._v(" mark 和 reset")]),t._v(" "),s("p",[t._v("mark 是在读取时，做一个标记，即使 position 改变，只要调用 reset 就能回到 mark 的位置")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("注意")])]),t._v(" "),s("p",[t._v("rewind 和 flip 都会清除 mark 位置")])]),t._v(" "),s("h4",{attrs:{id:"字符串与-bytebuffer-互转"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字符串与-bytebuffer-互转"}},[t._v("#")]),t._v(" 字符串与 ByteBuffer 互转")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),t._v(" buffer1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StandardCharsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UTF_8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你好"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),t._v(" buffer2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Charset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你好"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CharBuffer")]),t._v(" buffer3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StandardCharsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UTF_8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("p",[t._v("​")])])}),[],!1,null,null,null);a.default=e.exports}}]);